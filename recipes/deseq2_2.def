Bootstrap: localimage
From: R.sif

%help
    R image with DESeq2 installed for RNA-Seq analysis.
%arguments
	R_VERSION=3.4.1
%labels
    Software: DESeq2
    Software.version: 1.16.1
    Recipe.version: 1.0
    Maintainer: leo.jourdain@etu-upsaclay.fr / jaffar.gura@etu-upsaclay.fr

%post
    export DEBIAN_FRONTEND=noninteractive
    export PATH=/opt/R/3.4.1/bin:$PATH

    # Install required system dependencies
    apt-get update && apt-get install -y \
        libcurl4-openssl-dev \
        libssl-dev \
        libxml2-dev
    # Install DESeq2 dependencies using BiocInstaller
    # /opt/R/{{ R_VERSION }}/bin/Rscript -e 'library(BiocInstaller); biocLite(c("BiocGenerics", "S4Vectors", "IRanges", "GenomeInfoDb", "GenomicRanges", "SummarizedExperiment", "AnnotationDbi", "RcppArmadillo", "Rcpp", "Biobase", "BiocParallel","SummarizedExperiment"), dependencies=TRUE, type="source")'
    
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/BiocGenerics_0.22.1.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL BiocGenerics_0.22.1.tar.gz
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/S4Vectors_0.14.7.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL S4Vectors_0.14.7.tar.gz

    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/IRanges_2.10.5.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL IRanges_2.10.5.tar.gz
    # wget https://bioconductor.org/packages/3.5/data/annotation/src/contrib/GenomeInfoDbData_0.99.0.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL GenomeInfoDbData_0.99.0.tar.gz
    # wget https://cran.rstudio.com/src/contrib/bitops_1.0-9.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL bitops_1.0-9.tar.gz
    # wget https://cran.rstudio.com/src/contrib/RCurl_1.98-1.16.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL RCurl_1.98-1.16.tar.gz
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/GenomeInfoDb_1.12.3.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL GenomeInfoDb_1.12.3.tar.gz

    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/zlibbioc_1.22.0.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL zlibbioc_1.22.0.tar.gz
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/XVector_0.16.0.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL XVector_0.16.0.tar.gz

    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/GenomicRanges_1.28.6.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL GenomicRanges_1.28.6.tar.gz


    
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/Biobase_2.36.2.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL Biobase_2.36.2.tar.gz
    # wget https://cran.rstudio.com/src/contrib/matrixStats_1.4.1.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL matrixStats_1.4.1.tar.gz
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/DelayedArray_0.2.7.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL DelayedArray_0.2.7.tar.gz
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/SummarizedExperiment_1.6.5.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL SummarizedExperiment_1.6.5.tar.gz



    
    
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/BiocParallel_1.10.1.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL BiocParallel_1.10.1.tar.gz
    # wget https://bioconductor.org/packages/3.5/bioc/src/contrib/genefilter_1.58.1.tar.gz
    # /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL genefilter_1.58.1.tar.gz
    # /opt/R/3.4.1/bin/Rscript -e 'install.packages(c("Rcpp", "RcppArmadillo", "ggplot2", "Hmisc", "locfit"), repos="https://cran.rstudio.com", dependencies=TRUE)'


    # Install BiocManager if not already installed
    Rscript -e 'if (!requireNamespace("BiocManager", quietly=TRUE)) install.packages("BiocManager", repos="https://cran.rstudio.com/")'

    # Install DESeq2 and specified packages
    Rscript -e 'BiocManager::install(c("DESeq2", "S4Vectors", "IRanges", "GenomicRanges", "SummarizedExperiment", "BiocGenerics", "Biobase", "BiocParallel", "Rcpp", "RcppArmadillo"), update=TRUE, ask=FALSE)'
    # Install remotes if not already installed
    Rscript -e 'if (!requireNamespace("remotes", quietly = TRUE)) install.packages("remotes", repos = "http://cran.us.r-project.org")'

    #Install specific older versions directly using remotes
    Rscript -e 'install.packages("remotes", repos = "http://cran.us.r-project.org"); remotes::install_version("ggplot2", version = "2.2.1", repos = "http://cran.us.r-project.org")'
    Rscript -e 'remotes::install_version("Hmisc", version = "4.0-3", repos = "http://cran.us.r-project.org")'
    Rscript -e 'remotes::install_version("locfit", version = "1.5-9.1", repos = "http://cran.us.r-project.org")'
    # Install devtools if not already installed
    Rscript -e 'if (!requireNamespace("devtools", quietly = TRUE)) install.packages("devtools", repos = "http://cran.us.r-project.org")'

    # Load devtools and install specific older versions
    Rscript -e 'library(devtools); install_version("ggplot2", version = "2.2.1", repos = "http://cran.us.r-project.org")'
    Rscript -e 'library(devtools); install_version("Hmisc", version = "4.0-3", repos = "http://cran.us.r-project.org")'
    Rscript -e 'library(devtools); install_version("locfit", version = "1.5-9.1", repos = "http://cran.us.r-project.org")'
    wget https://bioconductor.org/packages/3.5/bioc/src/contrib/geneplotter_1.54.0.tar.gz
    /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL geneplotter_1.54.0.tar.gz
    wget https://bioconductor.org/packages/3.5/bioc/src/contrib/genefilter_1.58.1.tar.gz
    /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL genefilter_1.58.1.tar.gz



    

    


    wget https://bioconductor.org/packages/3.5/bioc/src/contrib/DESeq2_1.16.1.tar.gz
    /opt/R/{{ R_VERSION }}/bin/R CMD INSTALL DESeq2_1.16.1.tar.gz
    

%environment
    export PATH=${PATH}:/opt/R/{{ R_VERSION }}/bin

%runscript
    exec R "$@"




