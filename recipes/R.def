Bootstrap: docker
From: ubuntu:18.04

%help
    R base image with R 3.4.1 installed.

%labels
    Software: R
    Software.version: 3.4.1
    Recipe.version: 1.0
    Maintainer: leo.jourdain@etu-upsaclay.fr / jaffar.gura@etu-upsaclay.fr

%post
    export DEBIAN_FRONTEND=noninteractive
    apt-get update && apt-get install -y \
        build-essential \
        gfortran \
        libxml2-dev \
        libgfortran3 \
        libssl-dev \
        libcurl4-openssl-dev \
        libcurl4 \
        xorg-dev \
        libxt-dev \
        libstdc++6 \
        wget \
        libpng-dev \
        libjpeg-dev \
        libtiff-dev \
        libgtk2.0-dev \
        libreadline-dev \
        zlib1g-dev \
        libbz2-dev \
        libpcre3-dev \
        liblzma-dev

    # Enable source repositories
    sed -i.bak "/^# deb-src/s/^# //" /etc/apt/sources.list
    apt-get update && apt-get build-dep -y r-base

    # Download and install R 3.4.1
    wget -O R-3.4.1.tar.gz https://cran.rstudio.com/src/base/R-3/R-3.4.1.tar.gz
    tar -xzvf R-3.4.1.tar.gz
    cd R-3.4.1
    ./configure \
        --prefix=/opt/R/3.4.1 \
        --with-blas \
        --with-lapack \
        --with-recommended-packages \
        --without-x
    make -j$(nproc)
    make install
    cd ..
    rm -rf R-3.4.1*

%environment
    export PATH=/opt/R/3.4.1/bin:$PATH

%runscript
    exec R "$@"